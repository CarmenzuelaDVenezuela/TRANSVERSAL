class Escena8 {

  // ===== ESTADOS =====
  int estadoJuego = ESTADO_JUEGO;
  int estadoMujer = MUJER_VERDE;

  // Estados de Aurelio
  int estadoAurelio = AUR_QUIETO; // AUR_QUIETO, AUR_MOVIENDO, AUR_PERDIDO

  // ===== POSICIONES =====
  float aurX, aurY;
  float mujerX, mujerY;

  // ===== TAMAÃ‘OS =====
  int aurW = 150;
  int aurH = 350;
  int mujerW = 400;
  int mujerH = 1050;

  // ===== MOVIMIENTO =====
  float velocidadAur = 2; // movimiento continuo

  // ===== TEMPORIZADOR MUJER =====
  int tiempoCambioMujer = 0;
  int intervaloMujer = 5000;

  // ===== CONTROL TECLA =====
  boolean espacioPresionado = false;

  // ===== TEMPORIZADORES =====
  int tiempoAurPerdido = 0; // cuando Aurelio entra en estado perdido
  int duracionAurPerdido = 3000; // 3 segundos antes de Game Over

    // Imagenes   
  // PImage fondo8_1, fondo8_2, aur8, aur8_2, mujer1, mujer2, mujer3,;

    // Audio
  AudioPlayer audio8, pillado, disimulo;

  Escena8() {
    
    aurX = 500;
    aurY = height/2 + 100;

    mujerX = 200;
    mujerY = height/2 + 25;

    tiempoCambioMujer = millis();
    
        //Imagenes
     //fondo8_1 = loadImage("esc8_1.png");
     //fondo8_2 = loadImage("esc8_2.png");
     //aur8 = loadImage("a8.png");
     //aur8_2 = loadImage("a8_2.png");
     //mujer1 = loadImage("mujer1.png");
     //mujer2 = loadImage("mujer2.png");
     //mujer3 = loadImage("mujer3.png");
     
        // Audio
     //audio8 = audioManager.loadFile("esc8.mp3");
     //pillado = audioManager.loadFile("pillado.mp3"); 
     //disimulo = audioManager.loadFile("disimulo.mp3");
  }

  void dibujar() {
    rectMode(CENTER);
    background(200);

    switch (estadoJuego) {

      case ESTADO_JUEGO:
        actualizarMujer();
        manejarMovimientoAurelio();
        dibujarMujer();
        dibujarAurelio();
        comprobarVictoria();
        break;

      case ESTADO_GAME_OVER:
        dibujarMujer();
        dibujarAurelio();
        mostrarGameOver();
        break;

      case ESTADO_VICTORIA:
        dibujarMujer();
        dibujarAurelio();
        mostrarVictoria();
        break;
    }
  }

  // ==============================
  void actualizarMujer() {
    if (millis() - tiempoCambioMujer > intervaloMujer) {
      estadoMujer++;
      if (estadoMujer > MUJER_ROJA) estadoMujer = MUJER_VERDE;
      tiempoCambioMujer = millis();
    }
  }

  // ==============================
  void dibujarMujer() {
    if (estadoMujer == MUJER_VERDE) fill(0, 255, 0);
    else if (estadoMujer == MUJER_AMARILLA) fill(255, 255, 0);
    else fill(255, 0, 0);

    rect(mujerX, mujerY, mujerW, mujerH);
  }

  // ==============================
  void dibujarAurelio() {
    if (estadoAurelio == AUR_QUIETO) fill(0, 0, 255);
    else if (estadoAurelio == AUR_MOVIENDO) fill(255);
    else if (estadoAurelio == AUR_PERDIDO) fill(100); // gris
    rect(aurX, aurY, aurW, aurH);
  }

  // ==============================
  void manejarMovimientoAurelio() {
    if (estadoAurelio == AUR_PERDIDO) {
      // â¬› No puede moverse, activar temporizador
      if (millis() - tiempoAurPerdido > duracionAurPerdido) {
        estadoJuego = ESTADO_GAME_OVER;
      }
      return;
    }

    if (espacioPresionado && estadoJuego == ESTADO_JUEGO) {

      // ðŸš¨ Si mujer estÃ¡ roja â†’ Aurelio pasa a PERDIDO
      if (estadoMujer == MUJER_ROJA) {
        estadoAurelio = AUR_PERDIDO;
        tiempoAurPerdido = millis();
        println("âŒ PILLADO - Aurelio perdido");
        return;
      }

      // âœ… Mover Aurelio normalmente
      estadoAurelio = AUR_MOVIENDO;
      aurX += velocidadAur;
    } else {
      estadoAurelio = AUR_QUIETO;
    }
  }

  void teclaPulsada() {
    if (key == ' ') espacioPresionado = true;
  }

  void teclaLevantada() {
    if (key == ' ') espacioPresionado = false;
  }

  // ==============================
  void comprobarVictoria() {
    if (aurX + aurW/2 >= width) {
      estadoJuego = ESTADO_VICTORIA;
    }
  }

  void mostrarGameOver() {
    background(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text("INTÃ‰NTALO OTRA VEZ", width/2, height/2);
  }

  void mostrarVictoria() {
    fill(0, 255, 0);
    textAlign(CENTER, CENTER);
    textSize(50);
    text("Â¡VICTORIA!", width/2, height/2);
  }
}
